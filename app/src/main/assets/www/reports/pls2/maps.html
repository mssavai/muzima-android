<ons-page id="activity_count">
    <ons-toolbar>
        <div class="left">
            <ons-toolbar-button onclick="loggingInterface.decrementReportPeriodOffset()">
                <ons-icon icon="md-chevron-left"></ons-icon>
                <ons-icon icon="md-chevron-left"></ons-icon>
            </ons-toolbar-button>
            <span class="reportPeriodLabel"></span>
            <ons-toolbar-button class="incrementReportPeriodButton" onclick="loggingInterface.incrementReportPeriodOffset()">
                <ons-icon icon="md-chevron-right"></ons-icon>
                <ons-icon icon="md-chevron-right"></ons-icon>
            </ons-toolbar-button>
        </div>
        <div class="right">
            <ons-toolbar-button  onclick="openMenu()">
                <ons-icon icon="md-menu"></ons-icon>
            </ons-toolbar-button>
        </div>
    </ons-toolbar>
    <div id="map">Maaaaaaaaaap</div>
    <script>
        ons.getScriptPage().onInit = function() {
            refreshReportPeriodDisplayString();

        var map;

        console.log("In Scripts");
        function initMap() {
            console.log("Initializing map");
            var mapData = loggingInterface.getMapData();
            mapData = JSON.parse(mapData);
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 7,
                center: new google.maps.LatLng(-0.10221,34.76171),
            });

            var markers = [];
            mapData.map(function(data,i){
                console.log(data.label);
                var m = data.locations.map(function(location, j) {
                    console.log(j+" "+data.label.charAt(0));
                    return new google.maps.Marker({
                        position: location,
                        label: data.label.charAt(0)
                    });
                });
                markers = markers.concat(m);
            });


            var markerCluster = new MarkerClusterer(map, markers,
                {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});

        }};
    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBy41-d7Btm50DYUd9fNuUy7tzIPzGZRBg&callback=initMap">
    </script>

</ons-page>
