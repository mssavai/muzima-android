<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">

    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/materialize/materialicons.css">
    <link rel="stylesheet" href="css/onsenui.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">
    <link rel="stylesheet" href="css/material-design-iconic-font/css/material-design-iconic-font.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/materialize/1.0.0/materialize.min.css"  media="screen,projection"/>
    <script src="js/onsenui.min.js"></script>
    <script type="text/javascript" src="js/materialize/1.0.0/materialize.min.js"></script>
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<ons-splitter>
    <ons-splitter-side id="menu" side="left" width="220px" collapse swipeable>

        <ons-page>
            <ons-list>
                <ons-list-item tappable>
                    Report period:
                    <ons-list>
                        <ons-list-item onclick="loggingInterface.setCurrentReportPeriodAsWeekly()" tappable>
                            <label class="left">
                                <ons-radio name="visualization_period" input-id="weekly"></ons-radio>
                            </label>
                            <label for="weekly">
                                Show weekly reports
                            </label>
                        </ons-list-item>
                        <ons-list-item onclick="loggingInterface.showMonthlyReports()" tappable>
                            <label class="left">
                                <ons-radio name="visualization_period" input-id="monthly"></ons-radio>
                            </label>
                            <label for="monthly" class="center">
                                Show monthly reports
                            </label>
                        </ons-list-item>
                    </ons-list>
                </ons-list-item>
                <ons-list-item id="providerSelection">
                    Select Providers:
                    <ons-list id="providerList">

                    </ons-list>
                </ons-list-item>
                <ons-list-item onclick="loggingInterface.navigateToPage('settings.html')" tappable>
                    <ons-icon modifier="cta" icon="md-settings"></ons-icon> &nbsp;&nbsp;&nbsp;&nbsp;Settings
                </ons-list-item>
                <ons-list-item onclick="loggingInterface.navigateToPage('about.html')" tappable>
                    <ons-icon modifier="cta" icon="md-help"></ons-icon> &nbsp;&nbsp;&nbsp;&nbsp;Help
                </ons-list-item>
            </ons-list>
        </ons-page>
    </ons-splitter-side>
    <ons-splitter-content>
        <ons-navigator id="navigator">

            <ons-page>
                <ons-toolbar>
                    <div class="left">&nbsp;&nbsp;&nbsp;&nbsp; Expected performance settings</div>
                    <div class="right">
                        <ons-toolbar-button  onclick="openMenu()">
                            <i class="material-icons">menu</i>
                        </ons-toolbar-button>
                    </div>
                </ons-toolbar>
                <ons-dialog id="my-dialog" style="dis">
                    <div style="text-align: center; padding: 10px;">
                        <table id="settings-table" class="highlight">
                            <tr style="background-color:  #FDE9EB ">
                                <td><label for="patients-seen">Patients to be seen by providers daily:</label></td>
                                <td><select style="width:60%" id="patients-seen" class="select-input select-input--material">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                </select>
                                </td>
                            </tr>
                            <tr style="background-color: #FCFDE9">
                                <td><label for="expected-work-hours">Number of work hours per day:</label></td>
                                <td>
                                    <select id="expected-work-hours" class="select-input select-input--material">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                    </select>
                                </td>
                            </tr>
                            <tr style="background-color:#E9EDFD">
                                <td><label for="encounter-length">Number of minutes a Provider spents  seeing a Patient:</label></td>
                                <td>
                                    <select id="encounter-length" class="select-input select-input--material">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align:center"><ons-button>Save</ons-button></td>
                            </tr>
                        </table>
                    </div>
                </ons-dialog>
                <div id="settings-page">
                    <table id="settings-table" class="highlight">
                        <tr>
                            <td><label>Patients to be seen by providers daily:</label></td>
                            <td>
                                <span id="patients-seen">2</span> patients
                            </td>
                        </tr>
                        <tr>
                            <td><label>Number of work hours per day:</label></td>
                            <td>
                                <span id="expected-work-hours">2</span> hours
                            </td>
                        </tr>
                        <tr>
                            <td><label>Number of minutes a Provider spents  seeing a Patient:</label></td>
                            <td>
                                <span id="encounter-length">2</span> minutes
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align:center">
                                <ons-button modifier="light" onclick="showTemplateDialog()">Update</ons-button>
                                <a class="waves-effect waves-light btn">Cancel</a>
                            </td>
                        </tr>
                    </table>
                </div>
                <script>
                    var showTemplateDialog = function() {
                        var dialog = document.getElementById('my-dialog');

                        if (dialog) {
                            dialog.show();
                        } else {
                            ons.createElement('dialog.html', { append: true })
                                .then(function(dialog) {
                                    dialog.show();
                                });
                        }
                    };

                    var hideDialog = function(id) {
                        document
                            .getElementById(id)
                            .hide();
                    };
                </script>
            </ons-page>


        </ons-navigator>
    </ons-splitter-content>
</ons-splitter>


<script>
    const navigator = document.querySelector('#navigator');
    document.loadPage = function(pageToLoad)
    {
        if (pageToLoad != null && pageToLoad != '') {
            navigator.resetToPage(pageToLoad);
        }

        var sideMenuElement = document.getElementById("menu");
        if(pageToLoad == "login.html"){
            if(sideMenuElement.hasAttribute("swipeable")){
                sideMenuElement.removeAttribute("swipeable");
            }
        } else if(!sideMenuElement.hasAttribute("swipeable")){
            sideMenuElement.setAttribute("swipeable");
        }

        if(document.querySelector('ons-splitter-side').isOpen) {
            document.querySelector('ons-splitter-side').close();
        }
    }

    document.navigateBack = function(){
        navigator.popPage();
    }

    const openMenu = function() {
        var menu = document.getElementById('menu');
        menu.open();
    };

    const getRandom = function(factor){
        return Math.floor(Math.random() * factor);
    }

    const getRandomRgbColor = function(opacity){
        var r =  Math.floor(Math.random() * 255);
        var g =  Math.floor(Math.random() * 255);
        var b =  Math.floor(Math.random() * 255);
        return 'rgba('+ r +',' + g +',' + b + ',' + opacity +')';
    }

    const refreshReportPeriodDisplayString = function(){
        var reportPeriodString = loggingInterface.getReportPeriodDisplayString();
        var labels = document.getElementsByClassName('reportPeriodLabel');
        for (i = 0; i < labels.length; i++) {
            labels[i].innerHTML = reportPeriodString;
        }

        var buttons = document.getElementsByClassName('incrementReportPeriodButton');
        if(loggingInterface.getReportPeriodOffset() == 0){
            for (i = 0; i < buttons.length; i++) {
                buttons[i].setAttribute("disabled","disabled");
            }
        } else {
            for (i = 0; i < buttons.length; i++) {
                buttons[i].removeAttribute("disabled");
            }
        }

        var tabbar = document.querySelector('ons-tabbar');
        var activeTab = loggingInterface.getActiveTab();
        console.log("activeTab = "+activeTab);
        console.log(tabbar.getActiveTabIndex());
        if(activeTab == "tableTab"){
            tabbar.setActiveTab(0);
        } else {
            tabbar.setActiveTab(0);
        }
    }

    document.querySelector('ons-splitter-side').addEventListener('postclose', function() {
        loggingInterface.reloadCurrentPage();
    })

    const selectedProviders = [];
    const toggleSelectedProvider = function(value){
        var index = selectedProviders.indexOf(value);
        if(index > -1){

            console.log("Removing: "+value);
            selectedProviders.splice(index,1);
        } else {
            console.log("Adding: "+value);
            selectedProviders.push(value);
        }
        console.log(selectedProviders);
    }
    const addSelectedProvider = function(value){
        var index = selectedProviders.indexOf(value);
        if(index == -1){
            selectedProviders.push(value);
            console.log("Adding: "+value);
        }
    }
    const isProviderSelected = function(value){
        return selectedProviders.indexOf(value) > -1;
    }

    const getChartData = function(chartType){
        var chartData = loggingInterface.getChartData(chartType);
        chartData = JSON.parse(chartData);
        if(loggingInterface.isCurrentUserSupervisor()) {
            var filteredDataSets = [];
            chartData.datasets.forEach(function(dataset){
                if(!isProviderSelected(dataset.id)){
                    filteredDataSets.push(dataset);
                }
            });
            chartData.datasets = filteredDataSets;
        }

        return chartData;
    }


    var providerSelectorElement = document.getElementById("providerSelection");


</script>
</body>
</html>